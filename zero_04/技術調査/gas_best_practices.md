# Google Apps Script 実用ベストプラクティス

## 概要

Google Apps Script（GAS）は、複数ファイル（`.gs`）に分割できるが、**全てのコードはグローバルスコープで実行**される。\
RubyやPythonのようなファイル単位のスコープ分離やクラス/モジュール機能は無い。\
**ファイル分割は見た目の整理に過ぎず、スコープの安全は担保しない。**

---

## ファイル分割の考え方

- **役割ごとにファイルを分ける**（推奨）
  - 例: `constants.gs`（定数）、`utils.gs`（共通処理）、`main.gs`、`featureA.gs`など
- **ただし全ての関数・変数がグローバルで共有される**
  - 関数・変数の命名衝突に注意

---

## スコープと命名の注意点

- **同名の関数・変数は後勝ち（後にロードされた方が有効）**
- **グローバルな名前空間を汚染しやすい**
- スコープ分離したい場合は、**オブジェクトリテラル**や**IIFE**で手動管理する

### 例: 名前空間風の管理

```js
// utils.gs
var Utils = {
  sayHello: function(name) { Logger.log('Hello ' + name); }
}

// constants.gs
var CONST = {
  SPREADSHEET_ID: "xxxxxxx"
}

// main.gs
function main() {
  Utils.sayHello("naoki");
}
```

---

## 命名規則とドキュメンテーション

- **関数・変数には必ずプレフィックスをつける**などの命名規則で衝突を防ぐ
  - 例: `function slack_notify() { ... }`
  - 例: `const CALENDAR_EVENT_TYPE = ...;`
- **JSDocコメントで関数の役割や引数を記述**（将来の自分と他人のため）

---

## ファイル分割パターン例

- `constants.gs` … 定数置き場
- `utils.gs` … 共通処理
- `main.gs` … メインの業務ロジック
- `featureA.gs`, `featureB.gs` … 機能ごと
- `ui.gs` … UI系処理

---

## 小規模・個人開発の場合

- 全部1ファイルにまとめてもよいが、**肥大化するとメンテ不能**
- 規模が読めない場合は最初から役割分割を意識

---

## まとめ

- **ファイル分割は整理整頓。スコープ管理は自前で行う。**
- **役割分割＋名前空間風オブジェクト＋命名規則＋JSDoc**
- GASの限界を踏まえ、実用と可読性のバランスを最優先する

---

## おまけ：よくある落とし穴

- **同名関数・変数の上書きバグ**
- **“便利な共通関数”の無秩序な肥大化**
- **未来の自分が読めなくなる命名・コメント不足**

---

> **“どうせ全部グローバル、けれど乱雑にはしない。”**\
> **この現実主義を徹底するのがApps Script流。**

